# Документация по использованию проекта "Современный сайт объявлений"

## Оглавление

- [Документация по использованию проекта "Современный сайт объявлений"](#документация-по-использованию-проекта-современный-сайт-объявлений)
  - [Оглавление](#оглавление)
  - [Описание](#описание)
  - [Установка и запуск](#установка-и-запуск)
  - [Структура проекта](#структура-проекта)
  - [Основные возможности](#основные-возможности)
  - [Пользовательские страницы](#пользовательские-страницы)
  - [API и внутренние маршруты](#api-и-внутренние-маршруты)
  - [Работа с объявлениями](#работа-с-объявлениями)
    - [Создание объявления](#создание-объявления)
    - [Просмотр и редактирование](#просмотр-и-редактирование)
  - [Профиль пользователя](#профиль-пользователя)
  - [Чат с ИИ](#чат-с-ии)
  - [Тёмная тема и адаптивность](#тёмная-тема-и-адаптивность)
  - [Примеры](#примеры)
    - [Пример создания объявления](#пример-создания-объявления)
    - [Пример работы с чатом](#пример-работы-с-чатом)
  - [Возможные ошибки](#возможные-ошибки)
  - [Контакты и поддержка](#контакты-и-поддержка)
- [Подробная документация по каждому эндпоинту](#подробная-документация-по-каждому-эндпоинту)
  - [Пользовательские (HTML) страницы](#пользовательские-html-страницы)
    - [1. Лэндинг](#1-лэндинг)
    - [2. Регистрация](#2-регистрация)
    - [3. Вход](#3-вход)
    - [4. Выход](#4-выход)
    - [5. Главная после входа](#5-главная-после-входа)
    - [6. Все объявления](#6-все-объявления)
    - [7. Детальная страница объявления](#7-детальная-страница-объявления)
    - [8. Создать объявление](#8-создать-объявление)
    - [9. Мои объявления](#9-мои-объявления)
    - [10. Профиль пользователя](#10-профиль-пользователя)
    - [11. Чат с ИИ](#11-чат-с-ии)
  - [API-эндпоинты (JSON)](#api-эндпоинты-json)
    - [1. Проверка статуса сервера](#1-проверка-статуса-сервера)
    - [2. История чата](#2-история-чата)
    - [3. Отправка сообщения в чат](#3-отправка-сообщения-в-чат)
    - [4. Расширенная фильтрация объявлений (API)](#4-расширенная-фильтрация-объявлений-api)
    - [5. Поиск объявлений по тексту (API)](#5-поиск-объявлений-по-тексту-api)
    - [6. Статистика по объявлениям (API)](#6-статистика-по-объявлениям-api)
  - [API пользователей (`/users`)](#api-пользователей-users)
    - [1. Регистрация пользователя](#1-регистрация-пользователя)
    - [2. Получить пользователя по id](#2-получить-пользователя-по-id)
    - [3. Получить пользователей по роли](#3-получить-пользователей-по-роли)
    - [4. Получить свой профиль (API)](#4-получить-свой-профиль-api)
    - [5. Обновить свой профиль (API)](#5-обновить-свой-профиль-api)
  - [API объявлений (`/listings`)](#api-объявлений-listings)
    - [1. Создать объявление (API)](#1-создать-объявление-api)
    - [2. Получить список объявлений](#2-получить-список-объявлений)
    - [3. Получить объявление по id](#3-получить-объявление-по-id)
    - [4. Загрузить изображение к объявлению](#4-загрузить-изображение-к-объявлению)
    - [5. Расширенная фильтрация объявлений](#5-расширенная-фильтрация-объявлений)
    - [6. Поиск объявлений по тексту](#6-поиск-объявлений-по-тексту)
    - [7. Статистика по объявлениям](#7-статистика-по-объявлениям)
  - [Модели данных](#модели-данных)
    - [User](#user)
    - [Listing](#listing)
    - [Image](#image)
    - [ChatMessage](#chatmessage)
    - [Inflation](#inflation)
  - [Авторизация и ключи](#авторизация-и-ключи)
  - [Коды ошибок](#коды-ошибок)

---

## Описание

**Современный сайт объявлений** — это аналог Avito на FastAPI + Jinja2 + SQLAlchemy + SQLite, с регистрацией, авторизацией, личным кабинетом, фильтрацией, просмотром/созданием/редактированием объявлений, чатом с ИИ (YandexGPT), хранением истории чата, красивым адаптивным фронтендом и поддержкой тёмной темы.

---

## Установка и запуск

1. **Клонируйте репозиторий и перейдите в папку проекта:**
   ```bash
   git clone <repo_url>
   cd <project_folder>
   ```

2. **Создайте и активируйте виртуальное окружение:**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux/macOS
   .venv\Scripts\activate   # Windows
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Запустите сервер:**
   ```bash
   uvicorn app:app --reload
   ```

5. **Откройте сайт в браузере:**
   ```
   http://localhost:8000
   ```

---

## Структура проекта

- `app.py` — основной файл приложения FastAPI
- `models.py` — SQLAlchemy-модели (User, Listing, Image, ChatMessage)
- `schemas.py` — Pydantic-схемы для API и форм
- `routers/` — роутеры FastAPI (users, listings)
- `templates/` — Jinja2-шаблоны страниц
- `static/` — статические файлы (CSS, изображения)
- `database.py` — подключение к базе данных
- `requirements.txt` — зависимости проекта

---

## Основные возможности

- Регистрация и авторизация пользователей
- Личный кабинет с профилем и статистикой
- Создание, просмотр, редактирование и удаление объявлений
- Фильтрация и поиск объявлений
- Современный адаптивный дизайн (светлая/тёмная тема)
- Чат с ИИ (YandexGPT) и хранение истории сообщений
- Загрузка изображений к объявлениям
- Умная навигация и боковое меню

---

## Пользовательские страницы

- `/` — Лэндинг (главная, если не авторизован)
- `/register` — Регистрация
- `/login` — Вход
- `/dashboard` — Главная после входа (статистика, быстрые действия)
- `/listings` — Все объявления (фильтры, поиск)
- `/listing/{id}` — Детальная страница объявления
- `/create` — Создать объявление (расширенная форма)
- `/my` — Мои объявления (личный кабинет в стиле Avito Pro)
- `/profile` — Профиль пользователя (редактирование)
- `/chat` — Чат с ИИ

---

## API и внутренние маршруты

- `/api/health` — Проверка статуса сервера
- `/api/chat/history` — История чата пользователя (GET)
- `/api/chat/send` — Отправка сообщения в чат с ИИ (POST)
- `/users/*` — Роуты для работы с пользователями (регистрация, профиль и т.д.)
- `/listings/*` — Роуты для работы с объявлениями (создание, просмотр, загрузка фото и т.д.)

---

## Работа с объявлениями

### Создание объявления

- Перейдите на страницу `/create`
- Заполните все обязательные поля (заголовок, цена, адрес, описание, параметры квартиры, условия и т.д.)
- Нажмите "Создать" — объявление появится в разделе "Мои объявления" и в общем списке

### Просмотр и редактирование

- Все объявления доступны на `/listings`
- Ваши объявления — на `/my`
- Для каждого объявления доступна детальная страница `/listing/{id}` с подробной информацией и фото

---

## Профиль пользователя

- Страница `/profile`
- Можно изменить имя, email, телефон
- После сохранения выводится сообщение об успешном обновлении

---

## Чат с ИИ

- Страница `/chat`
- Современный чат с поддержкой тёмной темы
- История сообщений сохраняется
- Используется YandexGPT (IAM-токен настраивается в .env)

---

## Тёмная тема и адаптивность

- Переключение темы — кнопка 🌙/☀️ в шапке
- Все страницы и формы адаптированы под мобильные устройства
- Используются CSS-переменные для плавной смены темы

---

## Примеры

### Пример создания объявления

1. Перейдите на `/create`
2. Заполните:
   - Заголовок: "Квартира-студия, 25.8 м², 6/24 эт."
   - Цена: 3950000
   - Адрес: "ул. Уральская, д. 87/7"
   - Описание: "Просторная студия в новом доме..."
   - Количество комнат: "студия"
   - Общая площадь: 25.8
   - Жилая площадь: 17.5
   - Этаж: "6 из 24"
   - ...и другие параметры
3. Нажмите "Создать"

### Пример работы с чатом

- Откройте `/chat`
- Введите вопрос, например: "Как оформить ипотеку?"
- Получите ответ от ИИ

---

## Возможные ошибки

- **500 Internal Server Error** — не совпадают поля формы и модели (добавьте недостающие поля в модель Listing)
- **Пустые поля после сохранения профиля** — значения не были переданы или не сохранены в базе
- **Не отображаются объявления в /my** — исправьте обработчик, чтобы получать объявления пользователя из базы
- **Ошибка NameError: get_item_info is not defined** — используйте прямой запрос к базе через SQLAlchemy

---

## Контакты и поддержка

- Вопросы по запуску и настройке — пишите в issues репозитория
- Для интеграции YandexGPT — получите IAM-токен и пропишите его в .env

---

**Проект полностью готов для локального запуска и дальнейшей доработки!**  
Если нужна интеграция с внешними API, расширение фильтров, новые роли или дополнительные функции — пишите!

---

# Подробная документация по каждому эндпоинту

## Пользовательские (HTML) страницы

### 1. Лэндинг
- **GET /**  
  _Главная страница (если не авторизован)_
  - Тело запроса: нет
  - Ответ: HTML страница (landing.html)

### 2. Регистрация
- **GET /register**  
  _Форма регистрации_
  - Тело запроса: нет
  - Ответ: HTML страница (register.html)
- **POST /register**  
  _Регистрация пользователя_
  - Тело запроса (form-data):
    - name: str (обязательно)
    - email: str (обязательно)
    - password: str (обязательно)
  - Ответ: HTML страница или редирект на /dashboard

### 3. Вход
- **GET /login**  
  _Форма входа_
  - Тело запроса: нет
  - Ответ: HTML страница (login.html)
- **POST /login**  
  _Авторизация_
  - Тело запроса (form-data):
    - email: str (обязательно)
    - password: str (обязательно)
  - Ответ: HTML страница или редирект на /dashboard

### 4. Выход
- **GET /logout**  
  _Выход из аккаунта_
  - Тело запроса: нет
  - Ответ: Редирект на /

### 5. Главная после входа
- **GET /dashboard**  
  _Требует авторизации (cookie/session)_
  - Тело запроса: нет
  - Ответ: HTML страница (dashboard.html)

### 6. Все объявления
- **GET /listings**  
  _Параметры: region, price_min, price_max (query)_
  _Требует авторизации_
  - Тело запроса: нет
  - Ответ: HTML страница (listings.html)

### 7. Детальная страница объявления
- **GET /listing/{listing_id}**  
  _Требует авторизации_
  - Параметры: listing_id (path, int)
  - Тело запроса: нет
  - Ответ: HTML страница (listing.html)

### 8. Создать объявление
- **GET /create**  
  _Требует авторизации_
  - Тело запроса: нет
  - Ответ: HTML страница (create.html)
- **POST /create**  
  _Требует авторизации_
  - Тело запроса (form-data):
    - title: str (обязательно)
    - price: int (обязательно)
    - address: str (обязательно)
    - description: str (обязательно)
    - rooms: str (обязательно)
    - area: float (обязательно)
    - living_area: float (обязательно)
    - floor: str (обязательно)
    - ceiling_height: str (обязательно)
    - bathroom: str (обязательно)
    - windows: str (обязательно)
    - finish: str (обязательно)
    - sale_type: str (обязательно)
    - balcony: str (обязательно)
    - participation_type: str (обязательно)
    - completion_date: str (обязательно)
    - building_type: str (обязательно)
    - floors_total: int (обязательно)
    - passenger_lift: int (обязательно)
    - cargo_lift: int (обязательно)
    - yard: str (обязательно)
    - parking: str (обязательно)
  - Ответ: HTML страница (create.html)

### 9. Мои объявления
- **GET /my**  
  _Требует авторизации_
  - Тело запроса: нет
  - Ответ: HTML страница (my.html)

### 10. Профиль пользователя
- **GET /profile**  
  _Требует авторизации_
  - Тело запроса: нет
  - Ответ: HTML страница (profile.html)
- **POST /profile**  
  _Требует авторизации_
  - Тело запроса (form-data):
    - name: str (обязательно)
    - email: str (обязательно)
    - phone: str (опционально)
  - Ответ: HTML страница (profile.html)

### 11. Чат с ИИ
- **GET /chat**  
  _Требует авторизации_
  - Тело запроса: нет
  - Ответ: HTML страница (chat.html)

---

## API-эндпоинты (JSON)

### 1. Проверка статуса сервера
- **GET /api/health**  
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "status": "healthy",
      "message": "Сервер работает"
    }
    ```

### 2. История чата
- **GET /api/chat/history**  
  _Требует авторизации (cookie/session)_
  - Тело запроса: нет
  - Ответ: массив сообщений
    ```json
    [
      {
        "id": 1,
        "sender": "user",
        "message": "Как оформить ипотеку?",
        "timestamp": "2024-01-15 14:30:25"
      },
      {
        "id": 2,
        "sender": "ai",
        "message": "Для оформления ипотеки вам потребуется...",
        "timestamp": "2024-01-15 14:30:30"
      }
    ]
    ```

### 3. Отправка сообщения в чат
- **POST /api/chat/send**  
  _Требует авторизации (cookie/session)_
  - Тело запроса (JSON):
    ```json
    {
      "message": "Ваш вопрос"
    }
    ```
  - Ответ:
    ```json
    {
      "user": {
        "id": 1,
        "sender": "user",
        "message": "Ваш вопрос",
        "timestamp": "2024-01-15 14:30:25"
      },
      "ai": {
        "id": 2,
        "sender": "ai",
        "message": "Ответ от YandexGPT...",
        "timestamp": "2024-01-15 14:30:30"
      }
    }
    ```

### 4. Расширенная фильтрация объявлений (API)
- **GET /api/listings/filter**  
  - Параметры (query):
    - min_price: float (опционально) - Минимальная цена
    - max_price: float (опционально) - Максимальная цена
    - region: str (опционально) - Регион
    - address: str (опционально) - Адрес (поиск по подстроке)
    - rooms: str (опционально) - Количество комнат
    - min_area: float (опционально) - Минимальная общая площадь
    - max_area: float (опционально) - Максимальная общая площадь
    - min_living_area: float (опционально) - Минимальная жилая площадь
    - max_living_area: float (опционально) - Максимальная жилая площадь
    - min_kitchen_area: float (опционально) - Минимальная площадь кухни
    - max_kitchen_area: float (опционально) - Максимальная площадь кухни
    - floor: str (опционально) - Этаж
    - min_floor: int (опционально) - Минимальный этаж
    - max_floor: int (опционально) - Максимальный этаж
    - min_floors_total: int (опционально) - Минимальное количество этажей в доме
    - max_floors_total: int (опционально) - Максимальное количество этажей в доме
    - finish: str (опционально) - Тип отделки
    - sale_type: str (опционально) - Тип продажи
    - building_type: str (опционально) - Тип здания
    - bathroom: str (опционально) - Санузел
    - balcony: str (опционально) - Балкон/лоджия
    - windows: str (опционально) - Окна
    - mebel: str (опционально) - Мебель
    - tehnika: str (опционально) - Техника
    - internet_tv: str (опционально) - Интернет/ТВ
    - passenger_lift: int (опционально) - Пассажирский лифт
    - cargo_lift: int (опционально) - Грузовой лифт
    - yard: str (опционально) - Двор
    - parking: str (опционально) - Парковка
    - skip: int (по умолчанию 0) - Количество записей для пропуска
    - limit: int (по умолчанию 20) - Количество записей для возврата
    - sort_by: str (по умолчанию "id") - Поле для сортировки (price, area, id)
    - sort_order: str (по умолчанию "desc") - Порядок сортировки (asc, desc)
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "total": 5,
      "skip": 0,
      "limit": 20,
      "listings": [
        {
          "id": 1,
          "title": "Квартира-студия, 25.8 м², 6/24 эт.",
          "price": 3950000,
          "address": "ул. Уральская, д. 87/7",
          "description": "Просторная студия в новом доме с современной отделкой",
          "region": "Центральный",
          "rooms": "студия",
          "area": 25.8,
          "floor": "6 из 24",
          "kitchen_area": 8.5,
          "living_area": 17.5,
          "sanuzel": "раздельный",
          "remont": "евроремонт",
          "mebel": "частично",
          "tehnika": "встроенная",
          "internet_tv": "есть",
          "balkon_lodjiya": "лоджия",
          "room_type": "студия",
          "zalog": 0,
          "komissiya": 0,
          "po_schetchikam": "есть",
          "other_zhku": "парковка",
          "seller_id": 1,
          "images": []
        }
      ]
    }
    ```

### 5. Поиск объявлений по тексту (API)
- **GET /api/listings/search**  
  - Параметры (query):
    - q: str (обязательно) - Поисковый запрос
    - skip: int (по умолчанию 0) - Количество записей для пропуска
    - limit: int (по умолчанию 20) - Количество записей для возврата
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "total": 5,
      "skip": 0,
      "limit": 20,
      "query": "студия",
      "listings": [
        {
          "id": 1,
          "title": "Квартира-студия, 25.8 м², 6/24 эт.",
          "price": 3950000,
          "address": "ул. Уральская, д. 87/7",
          "description": "Просторная студия в новом доме с современной отделкой",
          "region": "Центральный",
          "rooms": "студия",
          "area": 25.8,
          "floor": "6 из 24",
          "kitchen_area": 8.5,
          "living_area": 17.5,
          "sanuzel": "раздельный",
          "remont": "евроремонт",
          "mebel": "частично",
          "tehnika": "встроенная",
          "internet_tv": "есть",
          "balkon_lodjiya": "лоджия",
          "room_type": "студия",
          "zalog": 0,
          "komissiya": 0,
          "po_schetchikam": "есть",
          "other_zhku": "парковка",
          "seller_id": 1,
          "images": []
        }
      ]
    }
    ```

### 6. Статистика по объявлениям (API)
- **GET /api/listings/stats**  
  - Параметры: нет
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "total_listings": 150,
      "price_stats": {
        "min_price": 1500000,
        "max_price": 15000000,
        "avg_price": 4500000,
        "count": 150
      },
      "region_stats": [
        {
          "region": "Центральный",
          "count": 45
        },
        {
          "region": "Северный",
          "count": 32
        },
        {
          "region": "Южный",
          "count": 28
        }
      ],
      "rooms_stats": [
        {
          "rooms": "студия",
          "count": 25
        },
        {
          "rooms": "1",
          "count": 40
        },
        {
          "rooms": "2",
          "count": 35
        },
        {
          "rooms": "3",
          "count": 30
        },
        {
          "rooms": "4+",
          "count": 20
        }
      ]
    }
    ```

---

## API пользователей (`/users`)

### 1. Регистрация пользователя
- **POST /users/register**  
  - Тело запроса (JSON):
    ```json
    {
      "name": "Иван Иванов",
      "email": "ivan@example.com",
      "password": "securepassword123",
      "role": "user"
    }
    ```
  - Ответ:
    ```json
    {
      "id": 1,
      "name": "Иван Иванов",
      "email": "ivan@example.com",
      "role": "user",
      "phone": null,
      "listings": []
    }
    ```

### 2. Получить пользователя по id
- **GET /users/{user_id}**  
  - Параметры: user_id (path, int)
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "id": 1,
      "name": "Иван Иванов",
      "email": "ivan@example.com",
      "role": "user",
      "phone": "+7 (999) 123-45-67",
      "listings": [
        {
          "id": 1,
          "title": "Квартира-студия",
          "price": 3950000,
          "address": "ул. Уральская, д. 87/7",
          "description": "Просторная студия в новом доме...",
          "region": "Центральный",
          "rooms": "студия",
          "area": 25.8,
          "floor": "6 из 24",
          "kitchen_area": 8.5,
          "living_area": 17.5,
          "sanuzel": "раздельный",
          "remont": "евроремонт",
          "mebel": "частично",
          "tehnika": "встроенная",
          "internet_tv": "есть",
          "balkon_lodjiya": "лоджия",
          "room_type": "студия",
          "zalog": 0,
          "komissiya": 0,
          "po_schetchikam": "есть",
          "other_zhku": "парковка",
          "seller_id": 1,
          "images": []
        }
      ]
    }
    ```

### 3. Получить пользователей по роли
- **GET /users/role/{role}**  
  - Параметры: role (path, str)
  - Тело запроса: нет
  - Ответ: массив пользователей
    ```json
    [
      {
        "id": 1,
        "name": "Иван Иванов",
        "email": "ivan@example.com",
        "role": "user",
        "phone": "+7 (999) 123-45-67",
        "listings": []
      },
      {
        "id": 2,
        "name": "Петр Петров",
        "email": "petr@example.com",
        "role": "user",
        "phone": null,
        "listings": []
      }
    ]
    ```

### 4. Получить свой профиль (API)
- **GET /users/me**  
  _Требует авторизации (cookie/session)_
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "id": 1,
      "name": "Иван Иванов",
      "email": "ivan@example.com",
      "role": "user",
      "phone": "+7 (999) 123-45-67",
      "listings": []
    }
    ```

### 5. Обновить свой профиль (API)
- **POST /users/me**  
  _Требует авторизации (cookie/session)_
  - Тело запроса (form-data):
    - name: str (обязательно)
    - email: str (обязательно)
    - phone: str (опционально)
  - Ответ:
    ```json
    {
      "id": 1,
      "name": "Иван Иванов",
      "email": "ivan@example.com",
      "role": "user",
      "phone": "+7 (999) 123-45-67",
      "listings": []
    }
    ```

---

## API объявлений (`/listings`)

### 1. Создать объявление (API)
- **POST /listings/**  
  - Тело запроса (JSON):
    ```json
    {
      "kv_img": "path/to/image.jpg",
      "kv_name": "ЖК Солнечный",
      "kv_zastr": "ООО Застройщик",
      "kv_stoim": 3950000,
      "kv_rayon": "Центральный",
      "kv_adres": "ул. Уральская, д. 87/7",
      "kv_about": "Новый дом с современной отделкой",
      "kv_condition": "продажа",
      "kv_rule": "Свободная продажа",
      "title": "Квартира-студия, 25.8 м², 6/24 эт.",
      "description": "Просторная студия в новом доме с современной отделкой",
      "price": 3950000,
      "address": "ул. Уральская, д. 87/7",
      "region": "Центральный",
      "rooms": "студия",
      "area": 25.8,
      "floor": "6 из 24",
      "kitchen_area": 8.5,
      "living_area": 17.5,
      "sanuzel": "раздельный",
      "remont": "евроремонт",
      "mebel": "частично",
      "tehnika": "встроенная",
      "internet_tv": "есть",
      "balkon_lodjiya": "лоджия",
      "room_type": "студия",
      "zalog": 0,
      "komissiya": 0,
      "po_schetchikam": "есть",
      "other_zhku": "парковка"
    }
    ```
  - Ответ:
    ```json
    {
      "id": 1,
      "kv_img": "path/to/image.jpg",
      "kv_name": "ЖК Солнечный",
      "kv_zastr": "ООО Застройщик",
      "kv_stoim": 3950000,
      "kv_rayon": "Центральный",
      "kv_adres": "ул. Уральская, д. 87/7",
      "kv_about": "Новый дом с современной отделкой",
      "kv_condition": "продажа",
      "kv_rule": "Свободная продажа",
      "title": "Квартира-студия, 25.8 м², 6/24 эт.",
      "description": "Просторная студия в новом доме с современной отделкой",
      "price": 3950000,
      "address": "ул. Уральская, д. 87/7",
      "region": "Центральный",
      "rooms": "студия",
      "area": 25.8,
      "floor": "6 из 24",
      "kitchen_area": 8.5,
      "living_area": 17.5,
      "sanuzel": "раздельный",
      "remont": "евроремонт",
      "mebel": "частично",
      "tehnika": "встроенная",
      "internet_tv": "есть",
      "balkon_lodjiya": "лоджия",
      "room_type": "студия",
      "zalog": 0,
      "komissiya": 0,
      "po_schetchikam": "есть",
      "other_zhku": "парковка",
      "seller_id": 1,
      "images": []
    }
    ```

### 2. Получить список объявлений
- **GET /listings/**  
  - Параметры (query):
    - skip: int (по умолчанию 0)
    - limit: int (по умолчанию 10)
    - region: str (опционально)
    - min_price: float (опционально)
    - max_price: float (опционально)
    - filter_avg_price: bool (опционально)
    - filter_inflation: bool (опционально)
  - Тело запроса: нет
  - Ответ: массив объявлений
    ```json
    [
      {
        "id": 1,
        "kv_img": "path/to/image.jpg",
        "kv_name": "ЖК Солнечный",
        "kv_zastr": "ООО Застройщик",
        "kv_stoim": 3950000,
        "kv_rayon": "Центральный",
        "kv_adres": "ул. Уральская, д. 87/7",
        "kv_about": "Новый дом с современной отделкой",
        "kv_condition": "продажа",
        "kv_rule": "Свободная продажа",
        "title": "Квартира-студия, 25.8 м², 6/24 эт.",
        "description": "Просторная студия в новом доме с современной отделкой",
        "price": 3950000,
        "address": "ул. Уральская, д. 87/7",
        "region": "Центральный",
        "rooms": "студия",
        "area": 25.8,
        "floor": "6 из 24",
        "kitchen_area": 8.5,
        "living_area": 17.5,
        "sanuzel": "раздельный",
        "remont": "евроремонт",
        "mebel": "частично",
        "tehnika": "встроенная",
        "internet_tv": "есть",
        "balkon_lodjiya": "лоджия",
        "room_type": "студия",
        "zalog": 0,
        "komissiya": 0,
        "po_schetchikam": "есть",
        "other_zhku": "парковка",
        "seller_id": 1,
        "images": [
          {
            "id": 1,
            "url": "/static/apartment1.jpg"
          }
        ]
      }
    ]
    ```

### 3. Получить объявление по id
- **GET /listings/{listing_id}**  
  - Параметры: listing_id (path, int)
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "id": 1,
      "kv_img": "path/to/image.jpg",
      "kv_name": "ЖК Солнечный",
      "kv_zastr": "ООО Застройщик",
      "kv_stoim": 3950000,
      "kv_rayon": "Центральный",
      "kv_adres": "ул. Уральская, д. 87/7",
      "kv_about": "Новый дом с современной отделкой",
      "kv_condition": "продажа",
      "kv_rule": "Свободная продажа",
      "title": "Квартира-студия, 25.8 м², 6/24 эт.",
      "description": "Просторная студия в новом доме с современной отделкой",
      "price": 3950000,
      "address": "ул. Уральская, д. 87/7",
      "region": "Центральный",
      "rooms": "студия",
      "area": 25.8,
      "floor": "6 из 24",
      "kitchen_area": 8.5,
      "living_area": 17.5,
      "sanuzel": "раздельный",
      "remont": "евроремонт",
      "mebel": "частично",
      "tehnika": "встроенная",
      "internet_tv": "есть",
      "balkon_lodjiya": "лоджия",
      "room_type": "студия",
      "zalog": 0,
      "komissiya": 0,
      "po_schetchikam": "есть",
      "other_zhku": "парковка",
      "seller_id": 1,
      "images": [
        {
          "id": 1,
          "url": "/static/apartment1.jpg"
        }
      ]
    }
    ```

### 4. Загрузить изображение к объявлению
- **POST /listings/{listing_id}/images/**  
  - Параметры: listing_id (path, int)
  - Тело запроса (form-data):
    - file: файл изображения (обязателен)
  - Ответ:
    ```json
    {
      "id": 1,
      "url": "/static/apartment1.jpg"
    }
    ```

### 5. Расширенная фильтрация объявлений
- **GET /listings/filter**  
  - Параметры (query):
    - min_price: float (опционально) - Минимальная цена
    - max_price: float (опционально) - Максимальная цена
    - region: str (опционально) - Регион
    - address: str (опционально) - Адрес (поиск по подстроке)
    - rooms: str (опционально) - Количество комнат
    - min_area: float (опционально) - Минимальная общая площадь
    - max_area: float (опционально) - Максимальная общая площадь
    - min_living_area: float (опционально) - Минимальная жилая площадь
    - max_living_area: float (опционально) - Максимальная жилая площадь
    - min_kitchen_area: float (опционально) - Минимальная площадь кухни
    - max_kitchen_area: float (опционально) - Максимальная площадь кухни
    - floor: str (опционально) - Этаж
    - min_floor: int (опционально) - Минимальный этаж
    - max_floor: int (опционально) - Максимальный этаж
    - min_floors_total: int (опционально) - Минимальное количество этажей в доме
    - max_floors_total: int (опционально) - Максимальное количество этажей в доме
    - finish: str (опционально) - Тип отделки
    - sale_type: str (опционально) - Тип продажи
    - building_type: str (опционально) - Тип здания
    - bathroom: str (опционально) - Санузел
    - balcony: str (опционально) - Балкон/лоджия
    - windows: str (опционально) - Окна
    - mebel: str (опционально) - Мебель
    - tehnika: str (опционально) - Техника
    - internet_tv: str (опционально) - Интернет/ТВ
    - passenger_lift: int (опционально) - Пассажирский лифт
    - cargo_lift: int (опционально) - Грузовой лифт
    - yard: str (опционально) - Двор
    - parking: str (опционально) - Парковка
    - skip: int (по умолчанию 0) - Количество записей для пропуска
    - limit: int (по умолчанию 20) - Количество записей для возврата
    - sort_by: str (по умолчанию "id") - Поле для сортировки (price, area, id)
    - sort_order: str (по умолчанию "desc") - Порядок сортировки (asc, desc)
  - Тело запроса: нет
  - Ответ: массив объявлений
    ```json
    [
      {
        "id": 1,
        "title": "Квартира-студия, 25.8 м², 6/24 эт.",
        "price": 3950000,
        "address": "ул. Уральская, д. 87/7",
        "description": "Просторная студия в новом доме с современной отделкой",
        "region": "Центральный",
        "rooms": "студия",
        "area": 25.8,
        "floor": "6 из 24",
        "kitchen_area": 8.5,
        "living_area": 17.5,
        "sanuzel": "раздельный",
        "remont": "евроремонт",
        "mebel": "частично",
        "tehnika": "встроенная",
        "internet_tv": "есть",
        "balkon_lodjiya": "лоджия",
        "room_type": "студия",
        "zalog": 0,
        "komissiya": 0,
        "po_schetchikam": "есть",
        "other_zhku": "парковка",
        "seller_id": 1,
        "images": []
      }
    ]
    ```

### 6. Поиск объявлений по тексту
- **GET /listings/search**  
  - Параметры (query):
    - q: str (обязательно) - Поисковый запрос
    - skip: int (по умолчанию 0) - Количество записей для пропуска
    - limit: int (по умолчанию 20) - Количество записей для возврата
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "total": 5,
      "skip": 0,
      "limit": 20,
      "query": "студия",
      "listings": [
        {
          "id": 1,
          "title": "Квартира-студия, 25.8 м², 6/24 эт.",
          "price": 3950000,
          "address": "ул. Уральская, д. 87/7",
          "description": "Просторная студия в новом доме с современной отделкой",
          "region": "Центральный",
          "rooms": "студия",
          "area": 25.8,
          "floor": "6 из 24",
          "kitchen_area": 8.5,
          "living_area": 17.5,
          "sanuzel": "раздельный",
          "remont": "евроремонт",
          "mebel": "частично",
          "tehnika": "встроенная",
          "internet_tv": "есть",
          "balkon_lodjiya": "лоджия",
          "room_type": "студия",
          "zalog": 0,
          "komissiya": 0,
          "po_schetchikam": "есть",
          "other_zhku": "парковка",
          "seller_id": 1,
          "images": []
        }
      ]
    }
    ```

### 7. Статистика по объявлениям
- **GET /listings/stats**  
  - Параметры: нет
  - Тело запроса: нет
  - Ответ:
    ```json
    {
      "total_listings": 150,
      "price_stats": {
        "min_price": 1500000,
        "max_price": 15000000,
        "avg_price": 4500000,
        "count": 150
      },
      "region_stats": [
        {
          "region": "Центральный",
          "count": 45
        },
        {
          "region": "Северный",
          "count": 32
        },
        {
          "region": "Южный",
          "count": 28
        }
      ],
      "rooms_stats": [
        {
          "rooms": "студия",
          "count": 25
        },
        {
          "rooms": "1",
          "count": 40
        },
        {
          "rooms": "2",
          "count": 35
        },
        {
          "rooms": "3",
          "count": 30
        },
        {
          "rooms": "4+",
          "count": 20
        }
      ]
    }
    ```

---

## Модели данных

### User
```json
{
  "id": 1,
  "name": "Иван Иванов",
  "email": "ivan@example.com",
  "role": "user",
  "phone": "+7 (999) 123-45-67"
}
```

### Listing
```json
{
  "id": 1,
  "kv_img": "path/to/image.jpg",
  "kv_name": "ЖК Солнечный",
  "kv_zastr": "ООО Застройщик",
  "kv_stoim": 3950000,
  "kv_rayon": "Центральный",
  "kv_adres": "ул. Уральская, д. 87/7",
  "kv_about": "Новый дом с современной отделкой",
  "kv_condition": "продажа",
  "kv_rule": "Свободная продажа",
  "title": "Квартира-студия, 25.8 м², 6/24 эт.",
  "description": "Просторная студия в новом доме с современной отделкой",
  "price": 3950000,
  "address": "ул. Уральская, д. 87/7",
  "region": "Центральный",
  "seller_id": 1,
  "rooms": "студия",
  "area": 25.8,
  "floor": "6 из 24",
  "kitchen_area": 8.5,
  "living_area": 17.5,
  "sanuzel": "раздельный",
  "remont": "евроремонт",
  "mebel": "частично",
  "tehnika": "встроенная",
  "internet_tv": "есть",
  "balkon_lodjiya": "лоджия",
  "room_type": "студия",
  "zalog": 0,
  "komissiya": 0,
  "po_schetchikam": "есть",
  "other_zhku": "парковка",
  "images": []
}
```

### Image
```json
{
  "id": 1,
  "url": "/static/apartment1.jpg"
}
```

### ChatMessage
```json
{
  "id": 1,
  "sender": "user",
  "message": "Как оформить ипотеку?",
  "timestamp": "2024-01-15 14:30:25"
}
```

### Inflation
```json
{
  "id": 1,
  "year": 2024,
  "month": 1,
  "rate": 0.05
}
```

---

## Авторизация и ключи

- Для большинства API-эндпоинтов требуется авторизация через cookie/session (выдаётся после входа через /login).
- Для API-запросов можно использовать JWT-токен, если реализовано (см. документацию по аутентификации).
- Для загрузки изображений используйте form-data с файлом.
- Для работы с YandexGPT требуется IAM-токен в переменной окружения `YANDEXGPT_IAM_TOKEN`.

---

## Коды ошибок

- **200** — Успешный запрос
- **302** — Редирект (обычно после авторизации)
- **401** — Не авторизован
- **404** — Ресурс не найден
- **422** — Ошибка валидации данных
- **500** — Внутренняя ошибка сервера

---
